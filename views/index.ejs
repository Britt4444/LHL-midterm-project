<!DOCTYPE html>
<html lang="en">

<head>
  <title>Home Page</title>

  <meta charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >

  <link rel="stylesheet" crossorigin="" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" crossorigin=""></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" />
  <link rel="stylesheet" href="/vendor/border-box.css" />
  <link rel="stylesheet" href="./styles/main.css" />
  <link rel="stylesheet" href="./styles/layout.css" />
  <link rel="stylesheet" href="./styles/header.css" />
  <link rel="stylesheet" href="./styles/add-event-form.css" />
  <link rel="stylesheet" href="./styles/new-marker-popup.css" />

  <!-- bootstrap linking -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


  <script src="/vendor/jquery-3.0.0.js"></script>
  

  <script defer src="/scripts/app.js"></script>
<!-- bootstrap linking -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>

<body>
   <div class="nav">
      <div class="nav-left">
        <h1 class="logo">Live Music Events</h1>
        <!-- <img src="./styles/icons/music.png" alt="Dancing people" > -->
      <form class="search-form"  action="">
        <input class="search-input" type="text" placeholder="Search by city" name="search">
        <button class = "search-button" type="submit"><i class="fa fa-search"></i></button>
      </form>

      </div>
      <div class="nav-right">
        <button class = "login-signup" id="login">LOGIN</button>
        <button class = "login-signup" id="signup">SIGNUP</button>
      </div>
    </div>
  </nav>

  <section class="add-event-section">
    <form id="event-form">
      <input class="event-input" type="text" id="name" placeholder="event name" name="name" required>

      <input class="event-input" type="text" id="city" placeholder="city" name="city" required>

      <textarea id="description" placeholder="description" name="description" required></textarea>

      <button class = "add-event" type="submit">Add event</button>
      <button class = "cancel-event" type="button">Cancel</button>
    </form>
  </section>

  <!-- DROPDOWM CREATED EVENTS -->
  <div class = "container">
    <div class = "container-dropdowns">
       <div class="dropdown">
         <button class="btn btn-primary dropdown-toggle" type="button" id="created-events-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Created Events
         </button>
       <div class="dropdown-menu" aria-labelledby="created-events-dropdown" id="created-events">
      <!-- Display created events' details here -->
      <!-- Example event item -->
      <!-- <a class="dropdown-item" href="#">
       
        <div class="float-right">
          <button class="btn btn-sm btn-info edit-event">Edit</button>
          <button class="btn btn-sm btn-danger delete-event">Delete</button>
        </div>
      </a> -->
    </div>
  </div>

    <div class="dropdown">
    <button class="btn btn-primary dropdown-toggle" type="button" id="favorite-events-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Favorite Events
    </button>
    <div class="dropdown-menu" aria-labelledby="favorite-events-dropdown" id="favorite-events">
      <!-- Display favorite events' details here -->
      <!-- Example event item -->
      <a class="dropdown-item" href="#">
     
        <div class="float-right">
          <button class="btn btn-sm btn-info edit-event">Edit</button>
          <button class="btn btn-sm btn-danger delete-event">Delete</button>
        </div>
      </a>
    </div>
  </div>
</div>
<div id="map"></div>
</div>
  

  <script>
$(document).ready(function() {
  let userId = 1; // Replace with the desired user ID

  // Fetch user's created events
  $.ajax({
    url: '/api/events',
    method: 'GET',
    success: function(response) {
      console.log('All events:', response.events);
      // Handle the success response and filter the events by the user ID
      let events = response.events.filter(function(event) {
        return event.creator_id === userId;
      });
       console.log('Filtered events:', events); 
      let dropdownMenu = $('#created-events');

      // Check if any events exist
      if (events.length > 0) {
        // Clear the dropdown menu
         dropdownMenu.empty();

        // Iterate over each event and create dropdown items
        events.forEach(function(event) {
          let eventItem = $('<a class="dropdown-item" href="#">')
            .text(event.name)
            .append('<div class="float-right">' +
              '<button class="btn btn-sm btn-info edit-event">Edit</button>' +
              '<button class="btn btn-sm btn-danger delete-event">Delete</button>' +
              '</div>');

          // Add event data as data attributes to the event item
          eventItem.data('event', event);

          dropdownMenu.append(eventItem);
        });
      } else {
        // If no events exist, display a message or placeholder item
        dropdownMenu.html('<span class="dropdown-item">No events found</span>');
      }
    },
    error: function(xhr, status, error) {
      // Handle the error response
      console.error('Error fetching events:', error);
    }
  });

  // Handle edit event click
  // $(document).on('click', '.edit-event', function(e) {
  //   e.preventDefault();
  //   let eventItem = $(this).closest('.dropdown-item');
  //   let event = eventItem.data('event');
  //   // Perform edit event action with the event data
  //   console.log('Edit event:', event);
  // });

  // Handle delete event click
  $(document).on('click', '.delete-event', function(e) {
    e.preventDefault();
    let eventItem = $(this).closest('.dropdown-item');
    let event = eventItem.data('event');
    // Perform delete event action with the event data
    console.log('Delete event:', event);
  });

  //  $.ajax({
  //       url: '/api/events/' + eventId,
  //       method: 'DELETE',
  //       success: function(response) {
  //         // Handle the success response
  //         console.log('Event deleted:', response);
  //         // Update the UI or perform any necessary actions
  //       },
  //       error: function(xhr, status, error) {
  //         // Handle the error response
  //         console.error('Error deleting event:', error);
  //       }
  //     });
});
  </script>


</body>

</html>
